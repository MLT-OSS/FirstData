# æ•°æ®æº Upsert å·¥ä½œæµç¨‹ä¸ç›®å½•ç»“æ„

**å¯¹åº”ä¸» SKILL.md æ­¥éª¤ 5ï¼šUpsert æ“ä½œï¼ˆè‡ªåŠ¨æ£€æµ‹åˆ›å»ºæˆ–æ›´æ–°ï¼‰**

## æ¦‚è¿°

Skill æ”¯æŒ **Upsert è¯­ä¹‰**ï¼ˆç±»ä¼¼ Python çš„ `dict[key] = value`ï¼‰ï¼š
- å¦‚æœæ•°æ®æºä¸å­˜åœ¨ â†’ **æ–°å»º**
- å¦‚æœæ•°æ®æºå·²å­˜åœ¨ â†’ **æ›´æ–°**ï¼ˆæ™ºèƒ½åˆå¹¶ï¼‰

**é»˜è®¤è¡Œä¸º**ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œæ— éœ€ç”¨æˆ·æŒ‡å®šæ“ä½œç±»å‹ã€‚

---

## å®Œæ•´æµç¨‹

### 1. æ£€æµ‹ç°æœ‰æ•°æ®æº

åœ¨ç”Ÿæˆ JSON æ•°æ®åã€ä¿å­˜æ–‡ä»¶å‰ï¼Œæœç´¢ `sources/` æ‰€æœ‰å­ç›®å½•ï¼ŒæŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ `id` çš„æ•°æ®æºæ–‡ä»¶ã€‚

**æœç´¢èŒƒå›´**ï¼š
- `sources/china/**/*.json`
- `sources/international/**/*.json`
- `sources/countries/**/*.json`
- `sources/academic/**/*.json`
- `sources/sectors/**/*.json`

**æ³¨æ„**ï¼šå¿½ç•¥ `.backup` åç¼€çš„å¤‡ä»½æ–‡ä»¶ã€‚

---

### 2. å†³å®šæ“ä½œç±»å‹

- **æœªæ‰¾åˆ°** â†’ æ‰§è¡Œ**æ–°å»º**æ“ä½œï¼ˆåˆ›å»ºæ–°æ–‡ä»¶ï¼‰
- **æ‰¾åˆ°** â†’ æ‰§è¡Œ**æ›´æ–°**æ“ä½œï¼ˆæ™ºèƒ½åˆå¹¶ï¼‰

---

### 3A. æ–°å»ºæ•°æ®æºï¼ˆCREATEï¼‰

æ ‡å‡†æ–°å»ºæµç¨‹ï¼š
1. **ä½¿ç”¨ datasource-classifier ç¡®å®šä¿å­˜è·¯å¾„**ï¼ˆè¯¦è§"ç¡®å®šä¿å­˜è·¯å¾„"éƒ¨åˆ†ï¼‰
2. åˆ›å»º JSON æ–‡ä»¶
3. éªŒè¯æ–‡ä»¶
4. æŠ¥å‘Šåˆ›å»ºæˆåŠŸ

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
âœ… å·²åˆ›å»º sources/international/health/who.json
ğŸ“ æ•°æ®æº ID: who | â­ è´¨é‡: 4.8/5.0
ğŸ”— URL: https://www.who.int/data
```

---

### 3B. æ›´æ–°æ•°æ®æºï¼ˆUPDATEï¼‰

æ›´æ–°æµç¨‹åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

#### 3B.1 åˆ›å»ºå¤‡ä»½

**åœ¨ä»»ä½•ä¿®æ”¹å‰ï¼Œå¿…é¡»å…ˆåˆ›å»ºå¤‡ä»½**ï¼š
- å¤‡ä»½æ–‡ä»¶åï¼š`{åŸæ–‡ä»¶å}.backup`
- æ¯æ¬¡æ›´æ–°è¦†ç›–æ—§å¤‡ä»½ï¼ˆåªä¿ç•™æœ€æ–°ï¼‰
- å¦‚æœåˆå¹¶å¤±è´¥ï¼Œä»å¤‡ä»½æ¢å¤

ç¤ºä¾‹ï¼š`pbc.json` â†’ `pbc.json.backup`

#### 3B.2 æ™ºèƒ½åˆå¹¶æ•°æ®

æŒ‰ç…§åˆå¹¶è§„åˆ™ï¼ˆè§ä¸‹æ–‡ï¼‰åˆå¹¶ç°æœ‰æ•°æ®å’Œæ–°æŠ“å–çš„æ•°æ®ã€‚

#### 3B.3 éªŒè¯åˆå¹¶ç»“æœ

ä½¿ç”¨ `schemas/datasource-schema.json` éªŒè¯åˆå¹¶åçš„æ•°æ®ï¼š
- âœ… **éªŒè¯é€šè¿‡** â†’ ä¿å­˜æ›´æ–°
- âŒ **éªŒè¯å¤±è´¥** â†’ ä¸­æ­¢æ“ä½œï¼Œä¿ç•™å¤‡ä»½ï¼Œä¸ä¿®æ”¹åŸæ–‡ä»¶

#### 3B.4 ä¿å­˜æ›´æ–°å¹¶æŠ¥å‘Š

ä¿å­˜åˆå¹¶åçš„æ•°æ®ï¼Œç”Ÿæˆå˜æ›´æ‘˜è¦æŠ¥å‘Šç»™ç”¨æˆ·ã€‚

---

## æ•°æ®åˆå¹¶è§„åˆ™

### å­—æ®µåˆ†ç±»

| å­—æ®µç±»åˆ« | åˆå¹¶ç­–ç•¥ | å­—æ®µç¤ºä¾‹ |
|---------|---------|---------|
| **ä¸å¯å˜å­—æ®µ** | ä¿æŒä¸å˜ | `id` |
| **URL å­—æ®µ** | æ›´æ–°ä¸ºæ–°å€¼ | `access.primary_url`, `organization.website`, `access.api.*` |
| **æè¿°å­—æ®µ** | é€‰æ‹©æ›´é•¿/æ›´è¯¦ç»†çš„ | `description.en`, `description.zh` |
| **è´¨é‡è¯„åˆ†** | **ä¿ç•™ç°æœ‰å€¼** âš ï¸ | `quality.*` ï¼ˆæ‰‹åŠ¨è¯„åˆ† > è‡ªåŠ¨è¯„åˆ†ï¼‰ |
| **æ•°ç»„å­—æ®µ** | å»é‡åˆå¹¶ | `tags`, `usage.use_cases`, `related_sources` |
| **æ—¶é—´èŒƒå›´** | æ›´æ–°ç»“æŸæ—¶é—´ï¼Œä¿ç•™èµ·å§‹ | `coverage.temporal.end_year` |
| **åˆ›å»ºä¿¡æ¯** | ä¿ç•™åŸå€¼ | `catalog_metadata.added_date`, `contributor` |
| **æ›´æ–°æ—¶é—´** | è®¾ä¸ºå½“å‰æ—¥æœŸ | `catalog_metadata.last_updated`, `verified_date` |

### é‡è¦åŸåˆ™

1. **è´¨é‡è¯„åˆ†å§‹ç»ˆä¿ç•™**ï¼šæ‰‹åŠ¨è¯„åˆ†æ¯”è‡ªåŠ¨æŠ“å–æ›´å‡†ç¡®ï¼Œé™¤éæ˜ç¡®è¦æ±‚æ›´æ–°
2. **æ•°ç»„å»é‡åˆå¹¶**ï¼š`tags`ã€`use_cases` ç­‰æ•°ç»„å­—æ®µï¼Œæ–°æ—§æ•°æ®å»é‡ååˆå¹¶
3. **æè¿°é€‰ä¼˜**ï¼šé€‰æ‹©æ›´è¯¦ç»†çš„æè¿°ï¼ˆé€šå¸¸æ˜¯æ›´é•¿çš„ï¼‰
4. **å…ƒæ•°æ®è¿½æº¯**ï¼šä¿ç•™åŸå§‹åˆ›å»ºæ—¥æœŸå’Œè´¡çŒ®è€…ï¼Œæ›´æ–°æœ€åä¿®æ”¹æ—¶é—´

---

## å˜æ›´æŠ¥å‘Š

æ›´æ–°å®Œæˆåï¼Œå‘ç”¨æˆ·æŠ¥å‘Šå˜æ›´æ‘˜è¦ï¼š

```
âœ… å·²æ›´æ–° sources/china/finance/banking/pbc.json

ğŸ“Š å˜æ›´æ‘˜è¦ï¼š
  - æ›´æ–°å­—æ®µ (3):
    * access.primary_url: http://old â†’ https://new
    * access.api.documentation: å·²æ·»åŠ 
    * catalog_metadata.last_updated: 2024-01-15 â†’ 2025-12-09

  - ä¿ç•™å­—æ®µ:
    * quality.* (æ‰€æœ‰è´¨é‡è¯„åˆ†)
    * catalog_metadata.contributor

  - æ•°ç»„æ–°å¢:
    * tags: banking, monetary-policy
    * usage.use_cases: Policy Making

  - å¤‡ä»½ä½ç½®: pbc.json.backup
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé¦–æ¬¡åˆ›å»º

```
ç”¨æˆ·è¾“å…¥: "æŠ“å– https://www.example.org/data æ•°æ®æº"
ç»“æœ: æœªæ‰¾åˆ°ç°æœ‰æ–‡ä»¶ â†’ åˆ›å»ºæ–°æ–‡ä»¶
è¾“å‡º: âœ… å·²åˆ›å»º sources/international/economics/example-data.json
```

### åœºæ™¯ 2ï¼šæ›´æ–°ç°æœ‰æ•°æ®æº

```
ç”¨æˆ·è¾“å…¥: "æŠ“å– https://www.who.int/data æ•°æ®æº"
ç»“æœ: æ‰¾åˆ°ç°æœ‰æ–‡ä»¶ â†’ å¤‡ä»½ â†’ åˆå¹¶ â†’ æ›´æ–°
è¾“å‡º: âœ… å·²æ›´æ–° sources/international/health/who.json + å˜æ›´æ‘˜è¦
```

### åœºæ™¯ 3ï¼šè‡ªåŠ¨ Upsertï¼ˆæ¨èï¼‰

```
ç”¨æˆ·è¾“å…¥: "å¤„ç† https://www.pbc.gov.cn/ æ•°æ®æº"  # ä¸æŒ‡å®šæ“ä½œç±»å‹
ç»“æœ: è‡ªåŠ¨æ£€æµ‹ â†’ æ‰¾åˆ°ç°æœ‰æ–‡ä»¶ â†’ æ‰§è¡Œæ›´æ–°
è¾“å‡º: âœ… å·²æ›´æ–° sources/china/finance/banking/pbc.json
```

---

## é”™è¯¯å¤„ç†

### éªŒè¯å¤±è´¥

```
âŒ åˆå¹¶æ•°æ®éªŒè¯å¤±è´¥ï¼Œæ“ä½œå·²ä¸­æ­¢
é”™è¯¯: Missing required field: access.primary_url
ğŸ’¡ åŸæ–‡ä»¶æœªä¿®æ”¹ï¼Œå¤‡ä»½å·²ä¿ç•™: pbc.json.backup
```

### æ–‡ä»¶æ“ä½œå¤±è´¥

```
âŒ æ–‡ä»¶æ“ä½œå¤±è´¥: Permission denied
ğŸ’¡ ä»å¤‡ä»½æ¢å¤: pbc.json.backup
```

---

## å·¥ä½œæµç¨‹å›¾

```
å¼€å§‹ â†’ æŠ“å–ä¿¡æ¯ â†’ ç”Ÿæˆæ•°æ® â†’ æå–ID
                                â†“
                        æ£€æµ‹åˆ°å·²å­˜åœ¨?
                    â†™ æ˜¯           å¦ â†˜
              åˆ›å»ºå¤‡ä»½           ç¡®å®šè·¯å¾„
                  â†“                 â†“
              æ™ºèƒ½åˆå¹¶           åˆ›å»ºæ–°æ–‡ä»¶
                  â†“                 â†“
              éªŒè¯ç»“æœ           éªŒè¯æ–‡ä»¶
                  â†“                 â†“
              ä¿å­˜æ›´æ–°           æŠ¥å‘Šåˆ›å»º
                  â†“                 â†“
              æŠ¥å‘Šå˜æ›´            ç»“æŸ
                  â†“
                ç»“æŸ
```

---

---

## ç¡®å®šä¿å­˜è·¯å¾„

### ä½¿ç”¨ datasource-classifier Sub-Agentï¼ˆæ¨èï¼‰

åœ¨ä¿å­˜å‰ï¼Œè°ƒç”¨ `@datasource-classifier` ç¡®å®šæœ€ä½³åˆ†ç±»è·¯å¾„ï¼š

```
@datasource-classifier
è¯·åˆ†ææ­¤æ•°æ®æºå¹¶ç¡®å®šåˆ†ç±»è·¯å¾„:
- ID: {id}
- ç»„ç»‡: {organization.name} ({organization.type})
- å›½å®¶: {organization.country}
- é¢†åŸŸ: {coverage.domains}
```

datasource-classifier ä¼šè¿”å›ï¼š
- æ¨èè·¯å¾„ï¼ˆå¦‚ `sources/china/finance/banking/pbc.json`ï¼‰
- åˆ†ç±»ç†ç”±å’Œç½®ä¿¡åº¦
- æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚é€‚ç”¨ï¼‰

### ç›®å½•ç»“æ„è§„åˆ™

å¦‚æœæ— æ³•ä½¿ç”¨ classifierï¼Œå‚è€ƒä»¥ä¸‹è§„åˆ™æ‰‹åŠ¨ç¡®å®šè·¯å¾„ï¼š

#### ä¸­å›½æ•°æ®æº (`sources/china/`)

```
china/
â”œâ”€â”€ national/          # å›½å®¶çº§æœºæ„
â”‚   â””â”€â”€ nbs.json
â”œâ”€â”€ finance/
â”‚   â”œâ”€â”€ banking/       # é“¶è¡Œä¸š
â”‚   â”‚   â”œâ”€â”€ pbc.json
â”‚   â”‚   â””â”€â”€ nfra.json
â”‚   â”œâ”€â”€ securities/    # è¯åˆ¸ä¸š
â”‚   â””â”€â”€ insurance/     # ä¿é™©ä¸š
â”œâ”€â”€ economy/
â”‚   â”œâ”€â”€ macro/         # å®è§‚ç»æµ
â”‚   â””â”€â”€ trade/         # è´¸æ˜“
â”œâ”€â”€ social/            # ç¤¾ä¼šé¢†åŸŸ
â”œâ”€â”€ education/         # æ•™è‚²
â”œâ”€â”€ health/            # å«ç”Ÿå¥åº·
â””â”€â”€ provincial/        # çœçº§æ•°æ®
```

**åˆ†ç±»è§„åˆ™**ï¼š
- å›½å®¶çº§æœºæ„ â†’ `china/national/`
- ç‰¹å®šé¢†åŸŸ â†’ `china/{domain}/{subdomain}/`

---

#### å›½é™…æ•°æ®æº (`sources/international/`)

```
international/
â”œâ”€â”€ economics/         # ç»æµ
â”‚   â”œâ”€â”€ worldbank.json
â”‚   â”œâ”€â”€ imf.json
â”‚   â””â”€â”€ oecd.json
â”œâ”€â”€ trade/            # è´¸æ˜“
â”œâ”€â”€ health/           # å¥åº·
â”œâ”€â”€ environment/      # ç¯å¢ƒ
â””â”€â”€ development/      # å‘å±•
```

**åˆ†ç±»è§„åˆ™**ï¼š
- æŒ‰ä¸»é¢˜é¢†åŸŸåˆ†ç±» â†’ `international/{domain}/`

---

#### å„å›½æ•°æ®æº (`sources/countries/`)

```
countries/
â”œâ”€â”€ north-america/
â”‚   â”œâ”€â”€ usa/
â”‚   â”‚   â”œâ”€â”€ census-bureau.json
â”‚   â”‚   â””â”€â”€ nber.json
â”‚   â””â”€â”€ canada/
â”‚       â””â”€â”€ statcan.json
â”œâ”€â”€ europe/
â”‚   â”œâ”€â”€ uk/
â”‚   â””â”€â”€ germany/
â”œâ”€â”€ asia/
â””â”€â”€ oceania/
```

**åˆ†ç±»è§„åˆ™**ï¼š
- æŒ‰æ´²å’Œå›½å®¶åˆ†ç±» â†’ `countries/{continent}/{country}/`
- æ–‡ä»¶åï¼šä½¿ç”¨æœºæ„ç®€ç§°ï¼ˆå¦‚ `census-bureau.json`, `statcan.json`ï¼‰

---

#### å­¦æœ¯æ•°æ®æº (`sources/academic/`)

```
academic/
â”œâ”€â”€ repositories/      # ç»¼åˆæ€§æ•°æ®ä»“åº“
â”‚   â”œâ”€â”€ icpsr.json
â”‚   â””â”€â”€ harvard-dataverse.json
â”œâ”€â”€ economics/         # ç»æµå­¦
â”‚   â””â”€â”€ nber.json
â”œâ”€â”€ health/            # å¥åº·åŒ»å­¦
â”‚   â”œâ”€â”€ pubmed.json
â”‚   â””â”€â”€ genbank.json
â”œâ”€â”€ environment/       # ç¯å¢ƒç§‘å­¦
â”œâ”€â”€ social/            # ç¤¾ä¼šç§‘å­¦
â””â”€â”€ biology/           # ç”Ÿå‘½ç§‘å­¦
```

**åˆ†ç±»è§„åˆ™**ï¼š
- ç»¼åˆæ€§ä»“åº“ â†’ `academic/repositories/`
- æŒ‰å­¦ç§‘é¢†åŸŸ â†’ `academic/{domain}/`

---

#### è¡Œä¸šæ•°æ®æº (`sources/sectors/`)

```
sectors/
â”œâ”€â”€ energy/                   # èƒ½æº
â”œâ”€â”€ innovation_patents/       # ç§‘æŠ€åˆ›æ–°-ä¸“åˆ©
â”œâ”€â”€ education/                # æ•™è‚²è¯„ä¼°
â”œâ”€â”€ agriculture_food/         # å†œä¸šä¸é£Ÿå“
â”œâ”€â”€ finance_markets/          # é‡‘èå¸‚åœº
â”œâ”€â”€ computer_science_ai/      # è®¡ç®—æœºç§‘å­¦ä¸AI
â”‚   â”œâ”€â”€ imagenet.json
â”‚   â””â”€â”€ kaggle.json
â”œâ”€â”€ nlp/                      # è‡ªç„¶è¯­è¨€å¤„ç†
â”œâ”€â”€ biology/                  # ç”Ÿç‰©ä¸ç”Ÿå‘½ç§‘å­¦
â”œâ”€â”€ chemistry_materials/      # åŒ–å­¦ä¸ææ–™
â”œâ”€â”€ geoscience_geography/     # åœ°çƒç§‘å­¦ä¸åœ°ç†
â”‚   â””â”€â”€ openstreetmap.json
â”œâ”€â”€ social_media/             # ç¤¾äº¤åª’ä½“ä¸ç½‘ç»œæ•°æ®
â”œâ”€â”€ sports/                   # ä½“è‚²è¿åŠ¨
â”œâ”€â”€ transportation/           # äº¤é€šè¿è¾“
â””â”€â”€ museums_culture/          # åšç‰©é¦†ä¸æ–‡åŒ–é—äº§
```

**åˆ†ç±»è§„åˆ™**ï¼š
- æŒ‰è¡Œä¸šé¢†åŸŸåˆ†ç±» â†’ `sectors/{domain}/`

---

### æ–‡ä»¶å‘½åè§„èŒƒ

ä½¿ç”¨æ•°æ®æº ID ä½œä¸ºæ–‡ä»¶åï¼š
- `{datasource-id}.json`
- ç¤ºä¾‹ï¼š`nbs.json`, `pbc.json`, `worldbank.json`

---

### é€‰æ‹©æµç¨‹

```
1. è¯†åˆ«æ•°æ®æºç±»å‹
   â†“
2. ç¡®å®šä¸»åˆ†ç±»ï¼ˆchina/international/countries/academic/sectorsï¼‰
   â†“
3. ç¡®å®šå­åˆ†ç±»ï¼ˆé¢†åŸŸ/å›½å®¶/å­¦ç§‘ï¼‰
   â†“
4. ä½¿ç”¨ datasource-classifier éªŒè¯
   â†“
5. åˆ›å»ºæ–‡ä»¶åˆ°ç¡®å®šçš„è·¯å¾„
```

---

## æ³¨æ„äº‹é¡¹

1. âš ï¸ **è´¨é‡è¯„åˆ†ä¸å¯è¦†ç›–**ï¼šé™¤éæ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™ä¿ç•™æ‰‹åŠ¨è¯„åˆ†
2. ğŸ”’ **ID ä¸å¯å˜æ›´**ï¼šæ•°æ®æº ID åœ¨åˆ›å»ºåä¸èƒ½ä¿®æ”¹
3. ğŸ“¦ **åªä¿ç•™æœ€æ–°å¤‡ä»½**ï¼šæ¯æ¬¡æ›´æ–°è¦†ç›–æ—§å¤‡ä»½ï¼Œä¸ä¿ç•™å†å²ç‰ˆæœ¬
4. âœ… **åˆå¹¶å‰å¿…éªŒè¯**ï¼šæ‰€æœ‰åˆå¹¶ç»“æœå¿…é¡»é€šè¿‡ schema éªŒè¯
5. ğŸš« **å¤‡ä»½æ–‡ä»¶è¢«å¿½ç•¥**ï¼šéªŒè¯è„šæœ¬ã€ç´¢å¼•ç”Ÿæˆå™¨è‡ªåŠ¨è·³è¿‡ `.backup` æ–‡ä»¶
6. ğŸ“ **ä¼˜å…ˆä½¿ç”¨ classifier**ï¼šä½¿ç”¨ `@datasource-classifier` ç¡®ä¿åˆ†ç±»å‡†ç¡®æ€§